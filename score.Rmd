%>% %>% %>% ---
title: "score"
author: "Zhuqoun Sheng"
date: "November 18, 2017"
output: pdf_document
---

```{r}
library(stringr)
library(ggplot2)
library(dplyr)

# prepared the matrixs needed

genres = read.csv("data/genre.csv")
movie = read.csv("data/movie_metadata_filtered.csv")
keywords = read.csv("data/keywords.csv")
actors = read.csv("data/actors.csv")
directors = read.csv("data/directors.csv")

genres_matrix = matrix(0,
                    nrow=dim(movie)[1],
                    ncol=dim(genres)[1])
colnames(genres_matrix)= genres$genres



for(i in 1:dim(genres)[1]){
genres_matrix[,i] =genres_matrix[,i] + 
  str_detect(movie$genres,pattern = as.character(genres[i,1]))
}

keywords_matrix = matrix(0,
                    nrow=dim(movie)[1],
                    ncol=dim(keywords)[1])
colnames(keywords_matrix)= keywords$plot_keywords

for(i in 1:dim(keywords)[1]){
keywords_matrix[,i] =keywords_matrix[,i] + 
  str_detect(movie$plot_keywords,pattern = as.character(keywords[i,1]))
}

actors_matrix = matrix(0,
                    nrow=dim(movie)[1],
                    ncol=dim(actors)[1])
colnames(actors_matrix)= actors$actor

for(i in 1:dim(actors)[1]){
actors_matrix[,i] =actors_matrix[,i] + 
  str_detect(movie$actor_1_name,pattern = as.character(actors[i,1]))  +
  str_detect(movie$actor_2_name,pattern = as.character(actors[i,1])) +
  str_detect(movie$actor_3_name,pattern = as.character(actors[i,1])) 
}

actors_matrix[actors_matrix > 0] = 1

directors_matrix = matrix(0,
                    nrow=dim(movie)[1],
                    ncol=dim(directors)[1])
colnames(directors_matrix)= directors$director_name

for(i in 1:dim(directors)[1]){
  directors_matrix[,i] =directors_matrix[,i] + 
  str_detect(movie$director_name,pattern =  as.character(directors[i,1]))
}

rm(actors,genres,keywords,directors,i)
```


```{r}
#mutate a new column represent the high score and low score
movie = mutate(movie,high_low = ifelse(imdb_score>7,1,0))

#get a new datafarme contains useful information
movie_useful = data.frame(movie$high_low,
                         movie$movie_title,
                         movie$duration,
                         movie$actor_1_facebook_likes,
                         movie$actor_2_facebook_likes,
                         movie$actor_3_facebook_likes,
                         movie$num_voted_users,
                         movie$facenumber_in_poster,
                         movie$cast_total_facebook_likes,
                         movie$num_user_for_reviews,
                         movie$num_critic_for_reviews,
                         movie$budget,
                         movie$aspect_ratio,
                         movie$title_year)
```

```{r}
set.seed(1)
train_n =sample(1:dim(movie_useful)[1],                                                     dim(movie_useful)[1]*0.7)

train_data = movie_useful[train_n,]
test_data = movie_useful[-train_n,]

glm=glm(movie.high_low~.-movie.movie_title,
       data=train_data,
       family="binomial")
summary(glm1)
rm(train_n)
```

```{r}
glm=glm(movie.high_low~.-movie.movie_title-movie.actor_3_facebook_likes,
       data=train_data,
       family="binomial")
summary(glm)
```
```{r}
glm=glm(movie.high_low~.-movie.movie_title-movie.actor_3_facebook_likes-movie.actor_2_facebook_likes,
       data=train_data,
       family="binomial")
summary(glm)
```
```{r}
glm=glm(movie.high_low~.-movie.movie_title-movie.actor_3_facebook_likes-movie.actor_2_facebook_likes-movie.cast_total_facebook_likes,
       data=train_data,
       family="binomial")
summary(glm)
```
```{r}
glm=glm(movie.high_low~.-movie.movie_title-movie.actor_3_facebook_likes-movie.actor_2_facebook_likes-movie.cast_total_facebook_likes-movie.actor_1_facebook_likes,
       data=train_data,
       family="binomial")
summary(glm)
```

Step by step, we elimated some variables' effect, include actor's facebook likes and cast_total_facebook_likes. In another words, all the variables contains facebook's effect. The IMDB_Score have nothing relate to the facebook.

For the remined variables, the longer the movie, the higher the score which is a little superice, however, the year also is a significant variables means that recent years the movie get harder than before to get a score higher then 7.0.

```{r}
glm.probabilities=predict(glm,type="response") 

i=seq(0,0.99,by=0.01)
summary.test.accuracy=NULL
for(Top10.probability in i){

}
summary.test.accuracy
```

